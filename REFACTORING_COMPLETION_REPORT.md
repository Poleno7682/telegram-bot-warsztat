# –û—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

## –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
2024-12-19

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

#### ‚úÖ `backend/app/utils/user_utils.py`
- `get_user_language(user, fallback)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ —Å fallback
- `get_user_or_error(...)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

#### ‚úÖ `backend/app/utils/date_formatter.py`
- `DateFormatter.format_date()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
- `DateFormatter.format_time()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
- `DateFormatter.format_datetime()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏

#### ‚úÖ `backend/app/utils/booking_utils.py`
- `format_booking_details()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `filter_future_bookings()` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥—É—â–∏—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- `group_bookings_by_date()` - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ

#### ‚úÖ `backend/app/utils/validators.py`
- `validate_phone()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `validate_telegram_id()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è Telegram ID

#### ‚úÖ `backend/app/utils/callback_utils.py`
- `parse_callback_data()` - –ø–∞—Ä—Å–∏–Ω–≥ callback_data
- `validate_callback_data()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è callback_data

#### ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω `backend/app/core/timezone_utils.py`
- `get_local_timezone()` - –ø–æ–ª—É—á–µ–Ω–∏–µ timezone —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `normalize_to_local()` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è datetime –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É timezone
- `ensure_timezone_aware()` - –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ timezone-aware datetime

---

## üîß –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–µ—Ä–≤–∏—Å—ã
1. ‚úÖ **`backend/app/services/time_service.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç –¥–ª—è timezone
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DateFormatter
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –Ω–∞ 80-85%

2. ‚úÖ **`backend/app/services/notification_service.py`**
   - –ó–∞–º–µ–Ω–∞ `TimeService.format_date/time` –Ω–∞ `DateFormatter`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `format_booking_details()`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `get_user_language()`

### Handlers
3. ‚úÖ **`backend/app/bot/handlers/booking.py`**
   - –ó–∞–º–µ–Ω–µ–Ω–æ 9+ –º–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —è–∑—ã–∫–∞ –Ω–∞ `get_user_language()`
   - –ó–∞–º–µ–Ω–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ `DateFormatter`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `format_booking_details()`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `validate_phone()`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `parse_callback_data()`

4. ‚úÖ **`backend/app/bot/handlers/mechanic.py`**
   - –ó–∞–º–µ–Ω–µ–Ω–æ 4 –º–µ—Å—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —è–∑—ã–∫–∞
   - –ó–∞–º–µ–Ω–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ `DateFormatter`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `filter_future_bookings()`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `group_bookings_by_date()`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `format_booking_details()`

5. ‚úÖ **`backend/app/bot/handlers/calendar.py`**
   - –ó–∞–º–µ–Ω–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞
   - –ó–∞–º–µ–Ω–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ `DateFormatter`

6. ‚úÖ **`backend/app/bot/handlers/common.py`**
   - –ó–∞–º–µ–Ω–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –Ω–∞ `get_user_language()`

7. ‚úÖ **`backend/app/bot/handlers/admin/services.py`**
   - –ó–∞–º–µ–Ω–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞

### Middlewares
8. ‚úÖ **`backend/app/bot/middlewares/i18n.py`**
   - –ó–∞–º–µ–Ω–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –Ω–∞ `get_user_language()`

### Repositories
9. ‚úÖ **`backend/app/repositories/booking.py`**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `get_local_timezone()` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è timezone

### Keyboards
10. ‚úÖ **`backend/app/bot/keyboards/inline.py`**
    - –ó–∞–º–µ–Ω–µ–Ω–æ `TimeService.format_date/time` –Ω–∞ `DateFormatter`

---

## ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
**–ë—ã–ª–æ:** –î—É–±–ª–∏—Ä–æ–≤–∞–ª–æ—Å—å 30+ —Ä–∞–∑ –ø–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É
```python
from app.config.settings import get_settings
settings = get_settings()
language = user.language if (user.language and user.language != LANGUAGE_UNSET) else (settings.supported_languages_list[0] if settings.supported_languages_list else "pl")
```

**–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã
```python
language = get_user_language(user)
```

**–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** ~200+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

### 2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
**–ë—ã–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `TimeService.format_date/time` –≤ 20+ –º–µ—Å—Ç–∞—Ö
**–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `DateFormatter.format_date/time`
**–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** ~100+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

### 3. –†–∞–±–æ—Ç–∞ —Å timezone
**–ë—ã–ª–æ:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ timezone –≤ 15+ –º–µ—Å—Ç–∞—Ö
```python
from app.config.settings import get_settings
settings = get_settings()
tz = pytz.timezone(settings.timezone)
if dt.tzinfo is None:
    dt_local = tz.localize(dt)
elif dt.tzinfo != tz:
    dt_local = dt.astimezone(tz)
```

**–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç
```python
from app.core.timezone_utils import normalize_to_local
dt_local = normalize_to_local(dt)
```

**–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** ~150+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, —É–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

### 4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
**–ë—ã–ª–æ:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ 10+ –º–µ—Å—Ç–∞—Ö
**–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `format_booking_details()`
**–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** ~100+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥
**–ë—ã–ª–æ:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
**–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç `validators.py` –∏ `callback_utils.py`
**–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** ~80+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

### 6. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
**–ë—ã–ª–æ:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –±—É–¥—É—â–∏—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
**–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `filter_future_bookings()` –∏ `group_bookings_by_date()`
**–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** ~60+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

## üìà –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ TimeService
- **–ë—ã–ª–æ:** 5-6 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- **–°—Ç–∞–ª–æ:** 1 –∑–∞–ø—Ä–æ—Å —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–£–ª—É—á—à–µ–Ω–∏–µ:** 80-85% —É–º–µ–Ω—å—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ timezone
- **–ë—ã–ª–æ:** –°–æ–∑–¥–∞–Ω–∏–µ timezone –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
- **–°—Ç–∞–ª–æ:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ timezone –æ–±—ä–µ–∫—Ç–∞
- **–£–ª—É—á—à–µ–Ω–∏–µ:** 95%+ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (config)
- **–ë—ã–ª–æ:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `get_settings()`
- **–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `@lru_cache` –≤ `user_utils.py`
- **–£–ª—É—á—à–µ–Ω–∏–µ:** –ï–¥–∏–Ω—ã–π –∫—ç—à –¥–ª—è –≤—Å–µ—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π

---

## üìù –ò—Ç–æ–≥–æ–≤—ã–µ —Ü–∏—Ñ—Ä—ã

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- **–í—Å–µ–≥–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ:** ~690+ —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- **–ü–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞:** ~200 —Å—Ç—Ä–æ–∫ ‚Üí 20 —Å—Ç—Ä–æ–∫
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç:** ~100 —Å—Ç—Ä–æ–∫ ‚Üí 30 —Å—Ç—Ä–æ–∫
- **Timezone –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:** ~150 —Å—Ç—Ä–æ–∫ ‚Üí 50 —Å—Ç—Ä–æ–∫
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:** ~100 —Å—Ç—Ä–æ–∫ ‚Üí 20 —Å—Ç—Ä–æ–∫
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥:** ~80 —Å—Ç—Ä–æ–∫ ‚Üí 30 —Å—Ç—Ä–æ–∫
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:** ~60 —Å—Ç—Ä–æ–∫ ‚Üí 20 —Å—Ç—Ä–æ–∫

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞ 80-85%
- **–°–æ–∑–¥–∞–Ω–∏–µ timezone –æ–±—ä–µ–∫—Ç–æ–≤:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞ 95%+
- **–í—ã–∑–æ–≤—ã get_settings():** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
- **–£—Ç–∏–ª–∏—Ç—ã:** 5 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
- **–†–∞—Å—à–∏—Ä–µ–Ω–æ:** 2 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª—è

---

## ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤

### S - Single Responsibility Principle ‚úÖ
–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É:
- `user_utils.py` - —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `date_formatter.py` - —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `validators.py` - —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- `callback_utils.py` - —Ç–æ–ª—å–∫–æ –ø–∞—Ä—Å–∏–Ω–≥ callback
- `booking_utils.py` - —Ç–æ–ª—å–∫–æ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

### O - Open/Closed Principle ‚úÖ
–£—Ç–∏–ª–∏—Ç—ã —Ä–∞—Å—à–∏—Ä—è–µ–º—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### L - Liskov Substitution Principle ‚úÖ
–£—Ç–∏–ª–∏—Ç—ã –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è

### I - Interface Segregation Principle ‚úÖ
–ú–∞–ª–µ–Ω—å–∫–∏–µ, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–æ–¥—É–ª–∏ - –∫–∞–∂–¥—ã–π —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É

### D - Dependency Inversion Principle ‚úÖ
–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—ã, –∞ –Ω–µ –ø—Ä—è–º—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- ‚úÖ Type hints –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤–µ–∑–¥–µ
- ‚úÖ Docstrings –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π

### –ü–æ–ª—É—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ù–ï –Ω–∞–π–¥–µ–Ω–æ
- ‚úÖ –í—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `get_user_language()`

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç/–≤—Ä–µ–º–µ–Ω–∏
- ‚ùå `TimeService.format_date/time` –ù–ï –Ω–∞–π–¥–µ–Ω–æ –≤ –∫–æ–¥–µ (–∫—Ä–æ–º–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ TimeService)
- ‚úÖ –í—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `DateFormatter`

### –†–∞–±–æ—Ç–∞ —Å timezone
- ‚ùå –ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ `pytz.timezone(settings.timezone)` –ù–ï –Ω–∞–π–¥–µ–Ω–æ (–∫—Ä–æ–º–µ —É—Ç–∏–ª–∏—Ç—ã)
- ‚úÖ –í—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `get_local_timezone()` –∏–ª–∏ `normalize_to_local()`

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `format_booking_details()` –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –º–µ—Å—Ç

---

## üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏

1. ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞** - ~690+ —Å—Ç—Ä–æ–∫
2. ‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - 80-90% –∑–∞ —Å—á–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
3. ‚úÖ **–°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤** - –≤—Å–µ –º–æ–¥—É–ª–∏ —Å–ª–µ–¥—É—é—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
4. ‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏** - –µ–¥–∏–Ω—ã–µ —Ç–æ—á–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. ‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏** - —É—Ç–∏–ª–∏—Ç—ã –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

1. **–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö handlers:**
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_user_language()` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DateFormatter` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –∏–∑ `utils/` –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

2. **–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å timezone:**
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `normalize_to_local()` –∏–ª–∏ `get_local_timezone()`
   - –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å timezone –æ–±—ä–µ–∫—Ç—ã –Ω–∞–ø—Ä—è–º—É—é

3. **–ü—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∏–∑ `utils/`
   - –ò–∑–±–µ–≥–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –î–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –≤ TimeService
   - –î–ª—è timezone –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –≤ `timezone_utils.py`
   - –î–ª—è config –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–∂–µ –µ—Å—Ç—å `@lru_cache`

---

## üéâ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, –∫–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID.

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2024-12-19  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

